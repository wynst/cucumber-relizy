#!/usr/bin/env ruby
# -*- mode: ruby -*-

require 'coffee-script'
require 'nokogiri'

file = ARGV[0]
raise ArgumentError unless File.exists?(file)

doc = Nokogiri::HTML(file)

a = doc.css("#cucumber-relizy")
if a && a.size>0
  a.remove
end

script = CoffeeScript.compile File.read("cucumber-html-relizy/js/cucumber-html-relizy.js.coffee")
a = doc.css("body").first
a.add_child("<script type='text/javascript' id='cucumber-relizy'>#{ script }</script>")

output = file.gsub(/html$/, 'relizy.html')
File.open(output,"w+") do |f|
  doc.write_to f
end



